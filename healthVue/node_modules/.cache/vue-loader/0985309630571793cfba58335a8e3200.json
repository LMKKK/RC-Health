{"remainingRequest":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\src\\views\\appointment copy.vue?vue&type=style&index=0&id=781e9f20&lang=css","dependencies":[{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\src\\views\\appointment copy.vue","mtime":1687283484049},{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1687062833539},{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1687062920062},{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1687062847882},{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1687062820333},{"path":"E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1687062902422}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5pcy1zZWxlY3RlZCB7CiAgY29sb3I6ICMxOTg5ZmE7Cn0K"},{"version":3,"sources":["E:\\兼职外包资料\\j06530-5111-健康管理平台-正在开发\\health\\healthVue\\src\\views\\appointment copy.vue"],"names":[],"mappings":";AA8aA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAChB","file":"E:/兼职外包资料/j06530-5111-健康管理平台-正在开发/health/healthVue/src/views/appointment copy.vue","sourceRoot":"","sourcesContent":["<template>\n  <div style=\"padding: 10px\">\n    <!--    搜索区域-->\n    <div style=\"margin: 10px 0\">\n      <el-input v-model=\"search\" placeholder=\"请输入关键字\" style=\"width: 20%\" clearable></el-input>\n      <el-button style=\"margin-left: 5px\" @click=\"load\">查询</el-button>\n      <!--管理员-->\n      <el-button type=\"success\" @click=\"showRule\" v-if=\"loginUser.roles[0] == 1\">查看预约规则</el-button>\n      <el-button type=\"primary\" @click=\"saveRule\" v-if=\"loginUser.roles[0] == 1\">新增/修改规则</el-button>\n      <!--普通用户-->\n      <el-button type=\"primary\" @click=\"add\" v-if=\"loginUser.roles[0] == 2\">新增预约</el-button>\n    </div>\n    <el-table v-loading=\"loading\" :data=\"tableData\" border stripe style=\"width: 100%\">\n      <el-table-column type=\"index\" label=\"序号\" sortable align=\"center\">\n      </el-table-column>\n      <el-table-column prop=\"number\" label=\"检查组编码\" align=\"center\">\n      </el-table-column>\n      <el-table-column prop=\"name\" label=\"检查组名称\" align=\"center\">\n      </el-table-column>\n      <el-table-column prop=\"suitSex\" label=\"适用性别\" align=\"center\">\n      </el-table-column>\n      <el-table-column prop=\"mnemonicCode\" label=\"助记码\" align=\"center\">\n      </el-table-column>\n      <el-table-column label=\"操作\" align=\"center\" width=\"200\">\n        <template #default=\"scope\">\n          <el-button size=\"mini\" type=\"primary\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-popconfirm title=\"确定删除吗？\" @confirm=\"handleDelete(scope.row.id)\">\n            <template #reference>\n              <el-button size=\"mini\" type=\"danger\">删除</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <div style=\"margin: 10px 0\">\n      <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :current-page=\"currentPage\"\n        :page-sizes=\"[5, 10, 20]\" :page-size=\"pageSize\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"total\">\n      </el-pagination>\n    </div>\n\n    <el-dialog title=\"预约规则信息查看\" v-model=\"ruleShowVisible\" style=\"width: 50%; margin: 0 auto 50px;\">\n\n      <!-- <el-calendar v-model=\"dateValue\">\n\n        <template\n              slot=\"dateCell\"\n              slot-scope=\"{date, data}\">\n            <p>\n              <button  style=\"color:orangered;\">2222</button>\n              \n            </p>\n          </template>\n\n      </el-calendar> -->\n\n      <el-calendar>\n    <template #date-cell=\"{ data }\">\n      <p :class=\"data.isSelected ? 'is-selected' : ''\">\n        {{ data.day.split('-').slice(1).join('-') }}\n        {{ data.isSelected ? '✔️' : '' }}\n      </p>\n    </template>\n  </el-calendar>\n\n\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"ruleShowVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"save('ruleForm')\">确 定</el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n    <el-dialog title=\"编辑预约规则\" v-model=\"ruleEditVisible\" style=\"width: 50%; margin: 0 auto 50px;\">\n\n      <el-form :model=\"ruleForm\" label-width=\"120px\" :rules=\"rules\" ref=\"ruleForm\">\n        <el-form-item label=\"月份\" prop=\"selectMonth\">\n          <el-date-picker v-model=\"ruleForm.selectMonth\" type=\"month\" placeholder=\"选择月\" @change=\"selectTime\">\n          </el-date-picker>\n        </el-form-item>\n        <el-divider>设置每日预约人数</el-divider>\n        <el-form-item label=\"日期\" v-for=\"(selectDay, index) in selectDays\" :key=\"selectDay.dayId\">\n          <el-input disabled=\"true\" v-model=\"selectDay.day\" style=\"width: 20%\"></el-input>\n          <label style=\"margin-left: 5%;\">可预约人数: </label>\n          <el-input placeholder=\"请输入可预约人数\" v-model=\"selectDay.limitPeople\" style=\"width: 20%\"></el-input>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"ruleEditVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"submitRule('ruleForm')\">确 定</el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n\n\n  </div>\n</template>\n\n<script>\n\nimport E from 'wangeditor'\nimport request from \"@/utils/request\";\nimport moment from \"moment\"\n\nlet editor;\n\nexport default {\n  name: 'checkSetMeal',\n  components: {},\n  data() {\n    return {\n      loading: true,\n      ruleForm: {},\n      ruleShowVisible: false,\n      search: '',\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      tableData: [],\n      vis: false,\n      detail: {},\n      rules: {\n        name: [{ required: true, message: '请输入套餐名称', trigger: 'blur' }],\n\n      },\n      multipleSelection: [],\n      checkItemsData: [],\n      loginUser: {},\n      dateValue: new Date(),\n      ruleEditVisible: false,\n      selectDays: [],\n      timeValue: \"\",\n      nowDate: new Date(),\n    }\n  },\n  created() {\n    this.load();\n    let userStr = sessionStorage.getItem(\"user\") || \"{}\"\n    let user = JSON.parse(userStr)\n    console.log(\"当前登陆者信息user：：\", user);\n    this.loginUser = user;\n  },\n  methods: {\n    filesUploadSuccess(res) {\n      console.log(res)\n      this.ruleForm.cover = res.data\n    },\n    load() {\n      this.loading = true\n      request.get(\"/appointment\", {\n        params: {\n          pageNum: this.currentPage,\n          pageSize: this.pageSize,\n          search: this.search\n        }\n      }).then(res => {\n        this.loading = false\n        this.tableData = res.data.records\n        this.total = res.data.total\n      })\n    },\n    add() {\n      this.dialogVisible = true\n      this.ruleForm = {}\n\n\n\n    },\n    showRule() {\n      this.ruleShowVisible = true\n      this.ruleForm = {}\n    },\n    saveRule() {\n      this.ruleEditVisible = true\n      this.ruleForm = {}\n    },\n    save(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          if (this.ruleForm.id) {  // 更新\n\n\n            console.log(this.selectDays);\n\n            //return;\n            let selectData = JSON.parse(JSON.stringify(this.multipleSelection));\n            console.log(\"选中的值：：\", selectData);\n            let groupIds = [];\n            selectData.forEach(element => {\n              groupIds.push(element.id);\n            });\n            this.ruleForm.groupIds = groupIds.toString();\n\n            let params = JSON.parse(JSON.stringify(this.ruleForm));\n            console.log(\"提交的参数信息：：\", params);\n            //return;\n            request.post(\"/appointment/update\", params).then(res => {\n              console.log(res)\n              if (res.code === '0') {\n                this.$message({\n                  type: \"success\",\n                  message: \"更新成功\"\n                })\n              } else {\n                this.$message({\n                  type: \"error\",\n                  message: res.msg\n                })\n              }\n              this.load() // 刷新表格的数据\n              this.dialogVisible = false  // 关闭弹窗\n            })\n          } else {  // 新增\n            let userStr = sessionStorage.getItem(\"user\") || \"{}\"\n            let user = JSON.parse(userStr)\n            this.ruleForm.createPeople = user.nickName\n            console.log(this.selectDays);\n\n\n            console.log(\"this.ruleForm::\", this.ruleForm);\n            return;\n            request.post(\"/appointment\", this.ruleForm).then(res => {\n              console.log(res)\n              if (res.code === '0') {\n                this.$message({\n                  type: \"success\",\n                  message: \"新增成功\"\n                })\n              } else {\n                this.$message({\n                  type: \"error\",\n                  message: res.msg\n                })\n              }\n\n              this.load() // 刷新表格的数据\n              this.dialogVisible = false  // 关闭弹窗\n            })\n          }\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n\n\n\n    },\n    handleEdit(row) {\n      console.log(\"row::\", row);\n      this.ruleForm = JSON.parse(JSON.stringify(row));\n      console.log(\"this.ruleForm::\", this.ruleForm);\n      this.dialogVisible = true\n      request.post(\"/appointment/getCheckGroupList\", this.ruleForm).then(res => {\n        console.log(res)\n        this.checkItemsData = res.data;\n\n\n        let formData = JSON.parse(JSON.stringify(row));\n        if (formData.groupIds) {\n          let ids = formData.groupIds.split(',');\n          console.log(\"ids：：\", ids)\n          this.checkItemsData.forEach(elemet => {\n\n            const elemetData = JSON.parse(JSON.stringify(elemet));\n            console.log(\"表格数据elemetData：：\", elemetData)\n            ids.forEach(id => {\n              if (id == elemet.id) {\n                this.$refs.multipleTable.toggleRowSelection(elemet, true)\n              }\n            });\n          });\n        }\n\n\n\n\n\n      })\n\n\n    },\n    handleDelete(id) {\n      console.log(id)\n      request.delete(\"/appointment/\" + id).then(res => {\n        if (res.code === '0') {\n          this.$message({\n            type: \"success\",\n            message: \"删除成功\"\n          })\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res.msg\n          })\n        }\n        this.load()  // 删除之后重新加载表格的数据\n      })\n    },\n    handleSizeChange(pageSize) {   // 改变当前每页的个数触发\n      this.pageSize = pageSize\n      this.load()\n    },\n    handleCurrentChange(pageNum) {  // 改变当前页码触发\n      this.currentPage = pageNum\n      this.load()\n    },\n    toggleSelection(rows) {\n      console.log(rows);\n      if (rows) {\n        rows.forEach(row => {\n          this.$refs.multipleTable.toggleRowSelection(row);\n        });\n      } else {\n        this.$refs.multipleTable.clearSelection();\n      }\n    },\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n    selectTime(val) {\n      console.log(val);\n\n      let month22 = moment(val).format(\"YYYY-MM\");\n      console.log(\"格式化日期：：\", month22);\n      let days = this.getCountDays(val);\n      this.selectDays = [];\n      for (let i = 0; i < days; i++) {\n        //console.log(i+1,\"日\");\n        if (i < 9) {\n          this.selectDays.push({ day: month22 + '-0' + (i + 1), dayId: i + 1 });\n        } else {\n          this.selectDays.push({ day: month22 + '-' + (i + 1), dayId: i + 1 });\n        }\n\n      }\n\n    },\n    // 获取一个月有多少天，curDate是开始日期，获取这个日期的月份的天数\n    getCountDays(curDate) {\n      const d = new Date(curDate)\n      const y = d.getFullYear()\n      //获取本月的下一个月\n      const m = d.getMonth() + 1\n      // 下一个月的第0天就是这个月的天数\n      const days = new Date(y, m, 0).getDate()\n      return days\n    },\n    submitRule(formName) {\n      let userStr = sessionStorage.getItem(\"user\") || \"{}\"\n      let user = JSON.parse(userStr)\n      this.ruleForm.createPeople = user.nickName\n      console.log(this.selectDays);\n\n\n\n      let days = JSON.parse(JSON.stringify(this.selectDays));\n      console.log(\"天数集合信息：：\", days);\n      let params = JSON.parse(JSON.stringify(this.ruleForm));\n      params.appointmentList = days;\n      console.log(\"提交的参数信息：：\", params);\n      //return;\n      request.post(\"/appointment/batchSaveAppointment\", params).then(res => {\n        console.log(res)\n        if (res.code === '0') {\n          this.$message({\n            type: \"success\",\n            message: \"保存成功\"\n          })\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res.msg\n          })\n        }\n\n        this.load() // 刷新表格的数据\n        this.ruleEditVisible = false  // 关闭弹窗\n      })\n\n\n\n    },\n    my_date(v) {\n      //console.log(v)\n      let len = this.res_date.length\n      let res = \"\"\n      for (let i = 0; i < len; i++) {\n\n        if (this.res_date[i].date == v) {\n          res = this.res_date[i].content\n          break\n        }\n      }\n      return res\n    },\n    my_date2(v) {\n      //console.log(v)\n      let len = this.res_date.length\n      let res = \"\"\n      for (let i = 0; i < len; i++) {\n\n        if (this.res_date[i].date == v) {\n          res = this.res_date[i].status\n          break\n        }\n      }\n      return res\n    },\n    dateClickSH(value) {\n      //console.log(value);\n      this.$router.push({path: \"/monitorManualInput\", query: {queryDate: value,status:1}});\n    },\n    dateClickFB(value) {\n      //console.log(value);\n      this.$router.push({path: \"/monitorManualInput\", query: {queryDate: value,status:2}});\n    },\n    dateClick(value) {\n      //console.log(value);\n      this.$router.push({path: \"/monitorManualInput\", query: {queryDate: value,status:3}});\n    },\n\n\n  }\n}\n</script>\n<style>\n.is-selected {\n  color: #1989fa;\n}\n</style>\n"]}]}